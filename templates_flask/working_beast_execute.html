<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REAL Beast Mode Execution | Working Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .execution-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .summary-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }

        .summary-section h3 {
            color: #2c3e50;
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .summary-section h3::before {
            margin-right: 10px;
            font-size: 1.5rem;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 5px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-label {
            color: #7f8c8d;
            font-weight: 500;
        }

        .summary-value {
            color: #2c3e50;
            font-weight: 600;
        }

        .beast-stats {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            text-align: center;
        }

        .beast-stats h2 {
            font-size: 2rem;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }

        .stat-item {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 18px 35px;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-execute {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            font-size: 1.2rem;
            padding: 20px 40px;
        }

        .btn-execute:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
            transform: translateY(-2px);
        }

        .progress-section {
            margin-top: 40px;
            display: none;
        }

        .progress-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .progress-header h3 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 25px;
            background: #ecf0f1;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00b894, #00cec9);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 15px;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            text-align: center;
            margin-top: 15px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .log-section {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 25px;
            border-radius: 15px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 25px;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);
        }

        .log-line {
            margin: 5px 0;
            padding: 3px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .log-line:last-child {
            border-bottom: none;
        }

        .log-success {
            color: #00b894;
        }

        .log-error {
            color: #ff6b6b;
        }

        .log-info {
            color: #74b9ff;
        }

        .warning-box {
            background: linear-gradient(135deg, #fdcb6e, #e84393);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
        }

        .warning-box h4 {
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .warning-box ul {
            margin-left: 20px;
        }

        .warning-box li {
            margin: 8px 0;
        }

        .real-indicator {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }

            .execution-card {
                padding: 25px;
            }

            .summary-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .action-buttons {
                flex-direction: column;
                align-items: center;
            }

            .header h1 {
                font-size: 2.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ REAL Beast Mode Execution</h1>
            <p>This will create actual campaigns in your Snapchat Ads Manager</p>
        </div>

        <div class="real-indicator">
            ‚ö†Ô∏è REAL MODE: This will create actual campaigns in your Snapchat account
        </div>

        <div class="execution-card">
            <!-- Configuration Summary -->
            <div class="summary-grid">
                <!-- Campaign Summary -->
                <div class="summary-section">
                    <h3 style="--icon: 'üìã';">üìã Campaign Details</h3>
                    <div class="summary-item">
                        <span class="summary-label">Name:</span>
                        <span class="summary-value">{{ data.campaign.campaign_name or 'Not set' }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Objective:</span>
                        <span class="summary-value">{{ data.campaign.objective or 'Not set' }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Daily Budget:</span>
                        <span class="summary-value">${{ data.campaign.daily_budget or '0' }}/day</span>
                    </div>
                </div>

                <!-- Ad Sets Summary -->
                <div class="summary-section">
                    <h3>üéØ Ad Set Configuration</h3>
                    <div class="summary-item">
                        <span class="summary-label">Bid Strategy:</span>
                        <span class="summary-value">{{ data.adsets.bid_strategy or 'Not set' }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Countries:</span>
                        <span class="summary-value">
                            {% if data.adsets.countries %}
                                {% for country in data.adsets.countries %}
                                    {% if country == 'SA' %}üá∏üá¶ Saudi Arabia{% endif %}
                                    {% if country == 'AE' %}üá¶üá™ UAE{% endif %}
                                    {% if country == 'US' %}üá∫üá∏ USA{% endif %}
                                    {% if country == 'GB' %}üá¨üáß UK{% endif %}
                                    {% if not loop.last %}, {% endif %}
                                {% endfor %}
                            {% else %}
                                Not set
                            {% endif %}
                        </span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Age Range:</span>
                        <span class="summary-value">{{ data.adsets.min_age or '22' }}-{{ data.adsets.max_age or '55' }}+ years</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Ad Sets:</span>
                        <span class="summary-value">{{ data.adsets.num_adsets or '5' }} ad sets</span>
                    </div>
                </div>

                <!-- Ads Summary -->
                <div class="summary-section">
                    <h3>üé® Creative Details</h3>
                    <div class="summary-item">
                        <span class="summary-label">Videos:</span>
                        <span class="summary-value">{{ data.ads.videos_path.split('\\')[-1] if data.ads.videos_path else 'Not set' }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Headlines:</span>
                        <span class="summary-value">{{ data.ads.csv_path.split('\\')[-1] if data.ads.csv_path else 'Not set' }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Brand:</span>
                        <span class="summary-value">{{ data.ads.brand_name or 'Not set' }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Website:</span>
                        <span class="summary-value">{{ data.ads.website_url or 'Not set' }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">CTA:</span>
                        <span class="summary-value">{{ data.ads.call_to_action or 'Not set' }}</span>
                    </div>
                </div>
            </div>

            <!-- Beast Mode Stats -->
            <div class="beast-stats">
                <h2>üî• Real Campaign Creation</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number">1</div>
                        <div class="stat-label">Campaign</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ data.adsets.num_adsets or '5' }}</div>
                        <div class="stat-label">Ad Sets</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ data.adsets.countries|length if data.adsets.countries else '0' }}</div>
                        <div class="stat-label">Countries</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${{ (data.adsets.adset_budget|int * data.adsets.num_adsets|int) if data.adsets.adset_budget and data.adsets.num_adsets else '0' }}</div>
                        <div class="stat-label">Daily Budget</div>
                    </div>
                </div>
            </div>

            <!-- Warning Box -->
            <div class="warning-box">
                <h4>‚ö†Ô∏è REAL Campaign Creation - Important Notes</h4>
                <ul>
                    <li><strong>This will create REAL campaigns</strong> in your Snapchat Ads Manager</li>
                    <li>Your API token must be valid and have campaign creation permissions</li>
                    <li>Campaign and ad sets will be created in PAUSED status for your review</li>
                    <li>You can activate them later in Snapchat Ads Manager</li>
                    <li>This process typically takes 2-5 minutes to complete</li>
                    <li>Campaign will appear immediately in your Snapchat account</li>
                </ul>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <a href="/folder-beast/reset" class="btn btn-secondary">‚Üê Start Over</a>
                <button onclick="startRealExecution()" class="btn btn-execute" id="executeBtn">
                    üöÄ CREATE REAL CAMPAIGN NOW!
                </button>
            </div>

            <!-- Progress Section (Hidden initially) -->
            <div class="progress-section" id="progressSection">
                <div class="progress-header">
                    <h3>üîÑ Real Campaign Creation in Progress</h3>
                    <p>Creating your campaign in Snapchat Ads Manager...</p>
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">Initializing...</div>

                <div class="log-section" id="logSection">
                    <div class="log-line log-info">[INFO] Real Beast Mode execution started...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let executionStarted = false;
        let executionId = null;
        let statusInterval = null;

        function startRealExecution() {
            if (executionStarted) return;

            const confirmed = confirm(
                `üö® REAL CAMPAIGN CREATION\n\n` +
                `This will create an actual campaign in your Snapchat Ads Manager:\n\n` +
                `Campaign: "${document.querySelector('.summary-value').textContent}"\n` +
                `Ad Sets: ${document.querySelectorAll('.summary-value')[6].textContent}\n` +
                `Countries: ${document.querySelectorAll('.summary-value')[4].textContent}\n\n` +
                `Are you absolutely sure you want to proceed?`
            );

            if (!confirmed) return;

            executionStarted = true;
            const executeBtn = document.getElementById('executeBtn');
            const progressSection = document.getElementById('progressSection');

            // Disable button and show progress
            executeBtn.disabled = true;
            executeBtn.textContent = 'üîÑ Creating Real Campaign...';
            executeBtn.style.background = '#95a5a6';
            progressSection.style.display = 'block';

            // Scroll to progress section
            progressSection.scrollIntoView({ behavior: 'smooth' });

            // Start real execution
            fetch('/folder-beast/execute-real', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.execution_id) {
                    executionId = data.execution_id;
                    // Start polling for status updates
                    statusInterval = setInterval(checkExecutionStatus, 1000);
                } else {
                    alert('Failed to start execution: ' + (data.error || 'Unknown error'));
                }
            })
            .catch(error => {
                alert('Error starting execution: ' + error);
                console.error('Error:', error);
            });
        }

        function checkExecutionStatus() {
            if (!executionId) return;

            fetch(`/api/execution-status/${executionId}`)
            .then(response => response.json())
            .then(data => {
                updateProgress(data.progress || 0, data.status || 'unknown');

                if (data.log && data.log.length > 0) {
                    updateLog(data.log);
                }

                if (data.status === 'completed') {
                    clearInterval(statusInterval);
                    showCompletionMessage(data);
                } else if (data.status === 'error') {
                    clearInterval(statusInterval);
                    showErrorMessage(data.error);
                }
            })
            .catch(error => {
                console.error('Status check error:', error);
            });
        }

        function updateProgress(progress, status) {
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');

            progressFill.style.width = progress + '%';

            let statusText = 'Processing...';
            switch(status) {
                case 'validating': statusText = 'Validating API token...'; break;
                case 'account_info': statusText = 'Getting account information...'; break;
                case 'creating_campaign': statusText = 'Creating campaign...'; break;
                case 'creating_adsets': statusText = 'Creating ad sets...'; break;
                case 'finalizing': statusText = 'Finalizing setup...'; break;
                case 'completed': statusText = 'Campaign created successfully!'; break;
                case 'error': statusText = 'Error occurred'; break;
            }

            progressText.textContent = statusText;
        }

        function updateLog(logEntries) {
            const logSection = document.getElementById('logSection');

            // Clear existing log and add new entries
            logSection.innerHTML = '';
            logEntries.forEach(entry => {
                const logLine = document.createElement('div');

                if (entry.includes('[ERROR]')) {
                    logLine.className = 'log-line log-error';
                } else if (entry.includes('[SUCCESS]') || entry.includes('created')) {
                    logLine.className = 'log-line log-success';
                } else {
                    logLine.className = 'log-line log-info';
                }

                logLine.textContent = entry;
                logSection.appendChild(logLine);
            });

            // Scroll to bottom
            logSection.scrollTop = logSection.scrollHeight;
        }

        function showCompletionMessage(data) {
            const successLog = document.createElement('div');
            successLog.className = 'log-line log-success';
            successLog.textContent = `[COMPLETE] üéâ Campaign "${data.campaign_name}" created successfully in Snapchat Ads Manager!`;
            document.getElementById('logSection').appendChild(successLog);

            setTimeout(() => {
                alert(`üéâ SUCCESS!\n\nYour campaign "${data.campaign_name}" has been created in Snapchat Ads Manager!\n\n‚úÖ Campaign ID: ${data.campaign_id}\n‚úÖ Ad Sets: ${data.ads_created}\n‚úÖ Status: PAUSED (ready to activate)\n\nGo to Snapchat Ads Manager to review and activate your campaign!`);
            }, 1000);
        }

        function showErrorMessage(error) {
            const errorLog = document.createElement('div');
            errorLog.className = 'log-line log-error';
            errorLog.textContent = `[ERROR] Campaign creation failed: ${error}`;
            document.getElementById('logSection').appendChild(errorLog);

            setTimeout(() => {
                alert(`‚ùå Campaign Creation Failed\n\nError: ${error}\n\nPlease check your API token and try again.`);
            }, 1000);
        }
    </script>
</body>
</html>